<html>
<head>
	<script src="js/lib/jquery-1.10.2.min.js"></script>
	<script src="js/lib/jquery.tmpl.js"></script>
	<script src="js/lib/glisse.js"></script>
	
	<link href="styles/style.css" rel="stylesheet" />
	<link href="styles/glisse.css" rel="stylesheet" />
</head>

<body>	
	<input type="submit" onclick="FetchCtrl(); return false;" value="Отправить" />

	<div id="updateAjaxDiv">
		<div id="albums">
			<div class="rowDiv"> </div>
		</div>
		<div id="photos"> </div>
	</div>
	
	<div style="margin: 30px auto;">
		<div id="next" style="text-align: center; height: 30px"> </div>
	</div>
</body>
</html>

<script type="text/javascript">
function FetchCtrl() {
	$.ajax({
		type: "GET",
		crossDomain: true,
		dataType: "jsonp",
		url: "http://api-fotki.yandex.ru/api/users/aleks2042/albums/?format=json"
	}).done(function(data) {
		for(var i=0; i < data.entries.length; i++)
		{
			if (i != 0 && i % 4 == 0)
				$('#albums').append('<div class="rowDiv"><div>');

			$('#albumTmpl').tmpl(data.entries[i]).appendTo('.rowDiv');
		}
	});
}

function GetPhotosInAlbum(url) {
	$.ajax({
		type: "GET",
		crossDomain: true,
		dataType: "jsonp",
		url: url
	}).done(function(data) {
		$('#next input').remove();
		GetPhotosUrl(data);	
	});
}

function GetPhotosUrl(data)
{
	var entries = data.entries;
	for(var i=0; i < entries.length; i++) {
		$('#photosTmpl').tmpl(entries[i]).appendTo('#photos');
	}
	$('#nextTmpl').tmpl(data).appendTo('#next');
	$('#albums').hide();

	$('.pics').glisse({
		changeSpeed: 550,
		speed: 500,
		effect:'bounce',
		fullscreen: true
	});
}
</script>

<script id="albumTmpl" type="text/x-jquery-tmpl">
	<div class="album-bag">
		<h2>
			${title}
		</h2>
		<a onclick="GetPhotosInAlbum('${links.photos}'); return false;">
			<img class="pics" src="${img.S.href}"/>
		</a>
	</div>
</script>

<script id="photosTmpl" type="text/x-jquery-tmpl">
	<div class="photo">
		<img class="pics" src="${img.S.href}" data-glisse-big="${img.orig.href}" rel="group1"/>
	</div>
</script>

<script id="nextTmpl" type="text/x-jquery-tmpl">
	<input type="button" onclick="GetPhotosInAlbum('${links.next}'); return false;" class="ksb" id="smb" value="Еще фото">
</script>